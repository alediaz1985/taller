{% extends 'base.html' %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/mantenimiento.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <h2>Consultar Mantenimientos</h2>

    <!-- Formulario de Consulta -->
    <form method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-4">
                {{ form.fecha_inicio.label_tag }}
                {{ form.fecha_inicio }}
            </div>
            <div class="col-md-4">
                {{ form.fecha_fin.label_tag }}
                {{ form.fecha_fin }}
            </div>
            <div class="col-md-4">
                {{ form.equipo.label_tag }}
                {{ form.equipo }}
            </div>
        </div>

        <!-- Búsqueda por texto -->
        <div class="row mt-3">
            <div class="col-md-6">
                {{ form.texto_busqueda.label_tag }}
                {{ form.texto_busqueda }}
            </div>
            <div class="col-md-6">
                <label class="radio-group-label">Buscar por:</label>
                {% for radio in form.tipo_busqueda %}
                    <div class="form-check form-check-inline">
                        {{ radio.tag }} {{ radio.choice_label }}
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Botones -->
        <div class="row mt-3">
            <div class="col-md-12 text-right">
                <button type="submit" class="button button-green">Consultar</button>
                {% if mantenimientos %}
                    <button type="submit" name="generar_pdf" class="button button-gray">Generar PDF</button>
                {% endif %}
            </div>
        </div>
    </form>

    <!-- Resultados de la Consulta -->
    {% if mantenimientos %}
    <h3>Resultados</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Equipo</th>
                <th>Nº Serie</th>
                <th>Tipo de Trabajo</th>
                <th>Observaciones</th>
                <th>Responsable</th>
            </tr>
        </thead>
        <tbody>
            {% for mantenimiento in mantenimientos %}
            <tr>
                <td>{{ mantenimiento.fecha|date:"d-m-Y H:i" }}</td>
                <td>{{ mantenimiento.equipo }}</td>
                <td>{{ mantenimiento.equipo.numero_serie }}</td>
                <td>{{ mantenimiento.tipo_trabajo }}</td> 
                <td>{{ mantenimiento.observaciones }}</td>
                <td>{{ mantenimiento.responsable }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        {% if request.method == "POST" %}
            <p>No se encontraron mantenimientos.</p>
        {% endif %}
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/mantenimiento.js' %}"></script>
{% endblock %}
